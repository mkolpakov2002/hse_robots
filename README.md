# Система дистанционного управления роботизированными устройствами
## Описание
ПО может быть востребовано техническими университетами и лабораториями для **облегчения процесса управления роботизированными устройствами** по *протоколу беспроводной передачи данных Bluetooth* с открытой **структурой пакета** передаваемых данных. С другой стороны, оно поможет решить проблему **демонстрации работы устройства**.

Приложение разработано **для использования** в домашних и учебных целях **инженерами, студентами, преподавателями и лаборантами**. 

## Функционал приложения
1.	**Подключение по Bluetooth** к определенным роботизированным устройствам;
2.	Дистанционное **управление функциями передвижения** устройства;
3.	**Управление несколькими устройствами** одновременно;
4.	Передача, получение и обработка данных данных с **использованием собственной структуры пакета**;
5.	**Добавление** в базу приложения собственного и сторонних **структур пакетов данных**;
6.	**Добавление** в базу приложения **поддерживаемых устройств** и информации о них.

## Технические требования
Приложение может быть использовано на любом **мобильном устройстве** (смартфоне или планшете) с операционной системой Android версии не ниже **6.0 Marshmallow (API 23)** и имеющем встроенный **Bluetooth модуль**.

## Структура файла пакета передачи данных
Для упрощения процесса составления XML кода протокола можно воспользоваться файлом шаблона по [ссылке](https://drive.google.com/file/d/1DgwXtwNb38TRlwDL3d81XfH5eFk_xhqG/view?usp=sharing)

Файл протокола передачи данных имеет **разрешение XML** и состоит из **тегов** участков сообщения, **каждый из которых имеет вложенные теги** с именами и возможными **значениями данного участка в байтах** (шестнадцатеричная система). 

Если какой-либо из участков сообщения **не используется в протоколе**, его **тег не указывается в файле**. **Обязательные теги не опускаются**. 

**Длина участка сообщения** для кодов команд рассчитывается **автоматически** как разность общей длины и введенных компонентов.

В **дефолтном протоколе** длина передаваемого пакета составляет **32 байта**. 
* Первые **4 байта** задают **класс и тип устройства отправления и устройства назначения соответственно**, которыми могут быть Android устройство, а также роботы на базе Arduino, или робот Darwin Mini. 
* Следующий **1 байт** занимает метка, отвечающая за указание какая отправляется команда: **новая или повтор предыдущей**. 
* Далее **1 байт** занимает один из 3 **типов команды**: перемещение, телеметрия и калибровка (калибровка либо установка скорости сервомоторов). 
* **Тип** задается в **старших 4 битах**, а **4-х младших** указывается количество байт **последующих далее данных**. Ими могут быть закодированы команды перемещения, данные телеметрии и калибровки.

## Руководство пользователя

Более подробно можно прочитать в [руководстве пользователя](https://drive.google.com/file/d/1zkhzHQyIvyE6i714tYS-aKuhP0ao2Z2Y/view?usp=sharing)

### Добавление устройства

Для добавления нового роботизированного устройства выберите один из вариантов в нижнем меню. 

По нажатию на кнопку «**ДОБАВИТЬ УСТРОЙСТВА ИЗ СПИСКА СОПРЯЖЕННЫХ**» откроется окно выбора MAC-адреса робота. 

Если **Bluetooth модуль** вашего робота **доступен для обнаружения** Android устройством но не сопряжен с ним, то по нажатию на кнопку «**НОВОЕ СОПРЯЖЕНИЕ**» внизу окна выбора MAC-адреса перейдите в настройки вашего Android устройства и **подключитесь к нужному MAC-адресу**, затем **вернитесь** к окну выбора МАС-адреса и так же **выберите нужный адрес** из сопряженных. 

Если же **робот не доступен для обнаружения** возможен **ручной ввод MAC-адреса** по нажатию на кнопку «**ДОБАВИТЬ УСТРОЙСТВА ВРУЧНУЮ ПО МАС**». При этом **откроется окно ввода** МАС адреса с автоматически примененной маской. Для введения доступны **заглавные буквы латинского алфавита и цифры**.

**После** выбора **MAC-адреса** робота откроется окно ввода **дополнительной информации** об устройстве. При ошибке ввода значений имени и протокола передачи возможно **редактирование данных** о роботе на главном экране. 

**MAC-адрес отредактировать невозможно**, в случае ошибки необходимо добавить робота заново.

### Добавление протокола

Для добавления нового протокола передачи данных необходимо перейти в **левое боковое меню** и нажать на элемент «**Добавить новый протокол**». 

Откроется окно добавления нового протокола. **Ограничения на имя** пустая строка и уникальность, так как в дальнейшем доступ к протоколам происходит только по имени. **Длина сообщения** должна быть не меньше самого длинного возможного сообщения, исходя из введенного кода протокола.

В **поле код** необходимо **ввести протокол передачи данных** в XML формате. Протокол можно **ввести вручную**, а также **прочитать из файла** (доступные расширения .txt и .xml). Для последнего необходимо разрешить приложению **доступ к внутренней памяти**.

### Подключение к устройствам

Подключиться к **одному устройству** возможно по нажатию на кнопку **ПОДКЛЮЧЕНИЕ в меню диалога**, которое открывается по нажатию на плитку с устройством из главного меню. После нажатия начнется поиск устройства с данным **MAC адресом**. Если подключение **не состоится**, то приложение вернется к главному меню, а внизу появится тост с сообщением, «**Подключение не успешно**».

Подключаться **одновременно** можно только **к устройствам с одинаковым протоколом передачи данных, а также классом и типом**, **в противном случае** выбор этих устройств одновременно будет **невозможен** и выведется соответствующее сообщение. Далее **для выбора нескольких устройств** для подключения, необходимо **зажать одно** из них на главном экране **до появления галочки** вместо аватарки. **Следующие** устройства можно выбрать **по обычному клику**. **Для старта** подключения необходимо нажать на кнопку внизу экрана **НАЧАТЬ СОЕДИНЕНИЕ**. 

## Разработчики

@mkolpakov2002 

@ytken

На базе УЛ САПР МИЭМ НИУ ВШЭ

